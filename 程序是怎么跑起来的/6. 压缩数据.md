# 6 压缩数据
在解说文件的压缩机制之前，首先了解一下：文件是将数据存储在磁盘等存储媒介中的一种形式。程序文件中存储数据的单位是字节。

## 6.1 RLE算法
RLE算法，就是把文件内容用“数据X重复次数”的形式来表示的压缩方法。比如`AAAAAABBCCDDEEEEEF`，17个字节，压缩后是`A6B2C1D2E5F1`，即12个字符。
### 6.1.1 缺点
但是实际上，同样字符多次重复的文本文件很少，因此不适合文本文件的压缩。如`ABCDEF`，6个字节，压缩后是`A1B1C1D1E1F1`，12个字节。

## 6.2 哈夫曼算法
哈夫曼算法的关键就是，它抛弃了“1个字符是1个字节（8 bit）的数据”这个概念，而是将多次出现的数据用小于8位的字节数来表示，不常用的数据则可以用超过8位的字节数来表示。可以联想到莫尔斯编码（摩斯电码）。
莫尔斯编码也是把一般文本中出现频率高的字复用短编码来表示，反之用长编码来表示。
压缩软件LHA就是用哈夫曼算法进行压缩的。
### 6.2.1 哈夫曼树
哈夫曼算法是指，通过借助哈夫曼树构造编码体系，为各压缩对象文件分别构造最佳的编码体系，并以此为基础进行压缩。
比如`AAAAAABBCCDDEEEEEF`，制作哈夫曼树：
 1. 列出数据和出现频率
 2. 选择频率最小的数字，将频率相加，作为父节点
 3. 重复步骤二，直到根节点
 4. 按照从根部到底部叶子节点的顺序，在左边的线处写0，右边写1。从根部到底部叶子节点的数字合起来，就是各个字母的编码。
 > 详细见P108
### 6.2.2 哈夫曼算法能够大幅提升压缩比率
制作哈夫曼树的过程中，从出现频率最低的数据开始，即出现频率越低的数据到达根部的枝条数越多，即出现频率越低的数据编码的位数越多。根据统计发现，哈夫曼算法能够大幅提升压缩比率。

## 6.7 可逆压缩和非可逆压缩
__可逆压缩__ 就是能还原到压缩前状态的压缩，相反的就是 __非可逆压缩__。
RLE算法和哈夫曼算法都是可逆压缩。而对于图像文件来说，多数情况下，并不要求可以还原，所以一般采用压缩率更高的非可逆压缩算法。以下是图像文件的一些常见格式：
 - BMP：Windows的标准图像数据格式，是完全未压缩的。
 - JPEG：非可逆压缩，压缩率高，数码相机中常用。
 > 一般有3种压缩方式：1. 从RGB转化成YCbCr，减少色度的数据。2. 进行傅里叶变换。3. 最后哈夫曼算法压缩，进一步缩小。
 - GIF：可逆压缩，但要求色数不超过256色，所以还原后颜色信息会有一些丢失。
 - TIFF：通过在文件头中包含标签显示出数据性质的图像数据形式，可以选择压缩格式。如果选择无压缩方式，会比BMP还要大，因为包含了文件头。