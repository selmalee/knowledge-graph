# 9 操作系统和应用的关系
广义来说，程序是操作系统、中间件、应用等所有软件的统称。
## 9.1 操作系统是多个程序的集合体
一开始，程序员需要用机器语言编写程序，再使用开关将程序输入。所以就有了能加载和运行功能的 __监控程序__ ，这就是操作系统的原型。后来又加入了基本的输入输出部分的程序，硬件控制程序，编程语言处理器（汇编、编译、解析）等很多程序都通用的部分，逐渐发展成了今天的操作系统。
## 9.2 操作系统和应用的关系
在[7.1 运行环境 = 操作系统 + 硬件](https://github.com/seminelee/knowledge-graph/blob/master/%E7%A8%8B%E5%BA%8F%E6%98%AF%E6%80%8E%E4%B9%88%E8%B7%91%E8%B5%B7%E6%9D%A5%E7%9A%84/7.%20%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83.md#71-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83--%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F--%E7%A1%AC%E4%BB%B6)有提到，在操作系统这个运行环境下，应用不是直接控制硬件，而是通过操作系统来控制硬件的。如：
``` c
#include <stdio.h>
#include <time.h>

void main() {
  time_t tm; // 申请分配内存空间
  time(&tm); // 将当前日期和时间数据保存到变量的内存空间中
  printf("%s\n", ctime(&tm));
}
```
程序中，内存的分配，使用的`time()`和`printf()`，都是面向操作系统的。操作系统收到指令后，会对指令进行解释，然后会对时钟IC和显示器用的I/O进行控制。详细看《计算机是怎么跑起来的》。
操作系统和高级编程语言使硬件抽象化。再如，文件是操作系统对磁盘媒介空间的抽象化。
``` c
#include <stdio.h>

void main() {
  FILE *fp = fopen("xxx.txt", "w"); // 打开文件，返回文件指针（fp）
  fputs("hello world", fp); // 写入文件
  fclose(fp); // 关闭文件
}
```
在C中，`fopen()`用来打开文件，`fputs()`用来往文件中写入，`fclose()`用来关闭文件。程序员不用关心如何指定扇区位置来对数据进行读写。应用程序打开文件后，操作系统就会自动申请分配用来管理文件读写的内存。

## 9.3 系统调用和高级编程语言的移植性
在9.2提及的，操作系统的硬件控制功能，通常是通过一些函数集合体来提供的（即`time()`和`printf()`的具体实现）。这些函数及调用函数的行为称为 __系统调用__（system call）。
如[7.3 不同操作系统的API不同](https://github.com/seminelee/knowledge-graph/blob/master/%E7%A8%8B%E5%BA%8F%E6%98%AF%E6%80%8E%E4%B9%88%E8%B7%91%E8%B5%B7%E6%9D%A5%E7%9A%84/7.%20%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83.md#73-%E4%B8%8D%E5%90%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84api%E4%B8%8D%E5%90%8C)所说，高级编程语言的机制就是，使用一样的函数名，如C的`time()`和`printf()`，然后再在编译时将其转换成相应的操作系统的系统调用（一个或多个的集合）。因此，高级编程语言的移植性高。

## 9.4 Windows操作系统的特征
以Windows为例，总结一下Windows操作系统的特征：
 - 64位（或32位）处理器
 - 通过API函数集来提供系统调用
 - 提供采用了GUI（图形用户界面）的用户界面
 - 通过WYSIWYG（what you see is what you get）实现打印输出
 - 提供多任务功能。通过 __时钟分割__ 技术来实现同时运行多个程序。即，Windows会自动切换多个程序的运行。另外，还具有以程序中的函数为单位来进行始终分割的 __多线程__ 功能。
 - 提供网络功能及数据库功能。网络功能及数据库功能也被称为 __中间件__，与操作系统一起称为 __系统软件__。
 - 通过即插即用实现设备驱动的自动设定。新的设备连接到计算机后，系统就会自动安装和设定用来控制该设备的设备驱动程序。设备驱动提供了同硬件进行基本的输入输出功能，包括键盘、鼠标、显示器、磁盘装备等。有时DLL文件也会同设备驱动文件一起安装。可以任意追加设备驱动和API的机制使Windows变得很灵活。
 