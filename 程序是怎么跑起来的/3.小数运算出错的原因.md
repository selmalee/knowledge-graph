# 3 小数运算

将0.1累加100次也得不到100，背后的原因是什么？

## 3.1 小数运算出错的原因

用二进制表示小数，如0.0011，转成十进制就是`0 + 0 + 0.125 + 0.0625 = 0.1875`。0.0001（2）表示0.0625（10），0.0010（2）表示0.125（10），这中间的小数，就无法用小数点后4位数的二进制数来表示。

| 二进制数 | 对应的十进制数 |
| -------- | -------------- |
| 0.0001   | 0.0625         |
| 0.0010   | 0.125          |
| 0.0011   | 0.1875         |
| 0.0100   | 0.25           |
| ...      | ...            |
| 0.1111   | 0.9375         |

实际上，十进制数0.1转换成二进制后，会变成0.00011001100...（1100循环）这样的循环小数。在遇到循环小数时，计算机会根据变量数据类型所对应的长度将数值从中间截断或者四舍五入。

这样比如用4位能表示的小数太少了，所以有了浮点数。

## 3.2 浮点数

浮点数是指用符号、尾数、基数和指数这4部分来表示的小数，即`+(或-)1.尾数*2^指数`。

很多编程语言中都提供了2种表示小数的数据类型，分别是双精度浮点数类型和单精度浮点数类型。C语言中，分别是double和float。

- 双精度浮点数类型：用64位表示，1位符号部分，11位指数部分，52位尾数部分。
- 单精度浮点数类型：用32位表示，1位符号部分，8位指数部分，23位尾数部分。

尾数部分用的是“将小数点前面的值固定为1的正则表达式”。

指数部分用的是“EXCESS系统表现”，比如单精度浮点数，8位指数部分最大值是11111111=255，即01111111=127表示的是0，大于01111111的就是正数，小于01111111的就是负数，01111110就是-1。

比如0.75（10）用单精度浮点数来表示就是0（符号）-01111110（尾数）-10000000000000000000000（尾数），即`+(1+2^(-1))*2^(-1)=1.5*0.5=0.75`。

但0.1（10）用单精度浮点数来表示，再计算一下十进制值仍然不是0.1。



## 3.3 如何避免出错

除了忽略，还可以把小数转换成正数来计算，即`0.1*10`后，再计算，最后把结果除以10即可。

还有BCD方法，就是用4位来表示0～9的1位数字的处理方法。



## 3.4 二进制数和十六进制数

使用二进制很方便，但是如果位数太多，看起来比较麻烦。所以在实际程序中，经常用十六进制数来代替二进制数。

二进制数的4位，正好相当于十六进制数的1位，如32位二进制数00111101110011001100110011001101用十六进制数来表示就是3DCCCCCD。
