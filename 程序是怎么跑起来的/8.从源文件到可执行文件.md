# 8 从源文件到可执行文件
## 8.1 计算机只能运行本地代码
用某种编程语言编写的程序就称为 __源代码__，保存源代码的文件称为 __源文件__，如`Sample.c`。
CPU只能直接解析并运行本地代码的程序。用任何编程语言编写的源代码，最后都要翻译成本地代码。

## 8.2 本地代码的内容
如`Sample.exe`文件的内容，就是本地代码。把exe文件dump一下，即把文件的内容用每个字节用2位十六进制数来表示，就可清晰地看到，本地代码的真面目是数值的罗列。
## 8.3 编译器
编译器：把C语言等高级编程语言编写的源代码，经过语法解析、句法解析、语义解析等，转换成本地代码的程序。
编译器也是一种程序，因此需要运行环境。根据CPU的类型不同，本地代码的类型也不同，因此有X86系CPU用的C编译器，Power PC用的C编译器。不同的操作系统有不同的编译器，如Windows用的C编译器、Linux用的C编译器。
总之，编译器与编程语言、CPU、操作系统有关。

## 8.4 链接器、启动和库文件

`Sample.c`文件编译后，生成`Sample.obj`，还需要进行“链接”处理。

把多个目标文件结合，生成1个exe文件就是 __链接__，运行 __链接__的程序就是 __链接器__。如：

``` bash
ilink32 -Tpe -c -x -aa c0w32.obj Sample.obj, Sample.exe,, import32.lib cw32.lib
```

- `c0w32.obj`是程序的__启动__，即运行主函数。

- `Sample.c`中使用了`sprintf()`和`MessageBox()`。`sprintf()`的目标文件在`cw32.lib`中，`MessageBox()`的目标文件在`import32.lib`中。像`cw32.lib`和`import32.lib`这样的文件就称为 __库文件__，即把多个目标文件继承保存到一个文件中的形式。

  - `sprintf()` 是__标准函数 __的一种，标准函数不是通过源代码形式，而是通过库文件形式和编译器一起提供的。这样即可避免繁琐，也可避免公开标准函数的源代码内容。像`cw32.lib`这样的库文件称为 __静态资源库__。
  - `MessageBox()`是Windows提供的API的一种。Windows以函数的形式为应用提供了各种功能，称为 __API__，如`MessageBox()`就提供了显示消息框的功能。Windows的API文件存储在 __DLL__文件，即 __动态链接库__。`import32.lib`中存储2个信息：`MessageBox()`在`user32.dll`中；DLL文件的文件夹信息。像`import32.lib`这样的库文件就称为__导入库__。

  

> __静态资源库__：存储着目标文件的实体，并直接和EXE文件结合的库文件形式。
>
> __静态资源库__：程序运行时动态结合的文件。

## 8.5 可执行文件的运行机制

如上生成EXE文件后，双击就会把EXE文件的内容加载到内存中运行。
