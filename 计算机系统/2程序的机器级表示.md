# 程序的机器级表示
我们使用高级语言编程的时候，机器屏蔽了程序的细节，即机器级的实现。优点在于，用高级语言编写的程序可以在很多不同的机器上编译和执行，而汇编代码则是与特定机器密切相关的。而且，在这种抽象级别上工作效率会更高，也更可靠（编译器提供的类型检查能帮助我们发现许多程序错误）。
计算机执行机器代码，用字节序列编码低级的操作，包括处理数据、管理内存、读写存储设备上的数据、利用网络通信等。编译器基于编程语言的规则、目标机器的指令集和操作系统遵循的惯例，经过一系列的阶段生成机器代码。
比如 _hello.c_ 程序，为了能在系统上运行，每条C语句都必须被其他程序转化为一系列的低级机器语言指令。然后这些指令按照一种称为 _可执行目标程序/文件_ 的格式打好包，并以二进制磁盘文件的形式存放起来。
在Unix系统上，这个转化的命令是`gcc -o hello hello.c`。`gcc`编译器将 _hello.c_ 翻译成了一个可执行文件 _hello_。这个翻译过程可分为四个阶段：
 1. 预处理阶段。预处理器(cpp)根据以字符#开头的命令，修改原始的C程序，比如读取系统头文件内容等。结果得到修改了的源程序 _hello.i_。
 2. 编译阶段。编译器（cc1）将 _hello.i_ 翻译成汇编程序 _hello.s_。汇编语言为不同高级语言的不同编译器提供了通用的输出语言。
  > 编译过程大致包括4个阶段：
  > - 分词分析，将字符串分割成词法单元。
  > - 语法分析，将词法单元组合，转换成抽象语法树AST。
  > - 遍历分析，对AST进行优化等，增删改查。
  > - 代码生成，转换成可执行代码，或中间码。
 3. 汇编阶段。接下来汇编器（as）将 _hello.s_ 翻译成机器语言指令，把这些指令打包成 _可重定位目标程序_ 的格式，并保存到目标文件 _hello.o_。
 4. 链接阶段。比如hello程序调用了`printf`函数，而`printf`函数存在于`printf.o`，一个存在于预编译标准C库的文件中，而这个文件必须合并到 _hello.o_中。链接器（ld）就负责处理这种合并。结果得到 _hello_ 文件。它是一个可执行文件，可以被加载到内存中，由系统执行。

> 编程语言可分为编译语言和解释语言。
> - 编译语言，需要先编译成计算机可以识别的机器码，然后计算机可以直接运行，因此运行速度较解释语言快。因为不同平台能识别的机器码不同，编译器也不同。所以有些高级语言，会先编译成字节码，即虚拟机能识别的中间码，由虚拟机来实现跨平台的兼容。
> - 解释语言，就是在执行虚拟机中一边翻译一边执行，即即时编译（JIT）。
> 比如，C/C++、GO 等都是编译型语言，编译后会生成可执行文件。而Java是先编译成中间码，然后由JVM虚拟机一边解析一边执行。JavaScript则是一种解释语言，由虚拟机一边解析一边执行，详细看[V8工作原理](https://www.cnblogs.com/bala/p/12205485.html)。
![编译器和解释器](https://img2018.cnblogs.com/common/945149/202001/945149-20200116135536725-1813073475.png)
![V8引擎](https://img2018.cnblogs.com/common/945149/202001/945149-20200116140226667-864961384.png)